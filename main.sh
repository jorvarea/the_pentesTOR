#!/bin/bash

GREEN="\033[32m"
BRIGHTBLUE="\033[1;34m"
RED="\033[31m"
RESET="\033[0m"

start_pentest=0
tor_running=0

echo "Checking if Tor is running..."
if ps aux | grep -w tor | grep -qv grep; then
	echo -e "${GREEN}Tor is running${RESET}"
	public_ip=$(curl -s ifconfig.me)
	tor_ip=$(proxychains curl -s icanhazip.com 2>/dev/null)
	location_info=$(curl -s "ipinfo.io/$tor_ip")
	echo -e "Your public IP address is: ${GREEN}$public_ip${RESET}"
    echo -e "Your Tor IP address is: ${GREEN}$tor_ip${RESET}"
	echo -e "Your Tor IP location is: ${GREEN}$(echo $location_info | jq '"\(.city), \(.region), \(.country)"')${RESET}"
	start_pentest=1
	tor_running=1
else
	echo -e "${RED}Tor is not running${RESET}"
	read -p "Do you wish to continue? [y/n] " answer
	case $answer in
		[yY]* )
			start_pentest=1
			;;
		[nN]* )
			start_pentest=0
			;;
		* )
			exit 1
			;;
	esac
fi

if [ "$tor_running" -eq 1 ]; then
    proxy_command="proxychains"
else
    proxy_command=""
fi

if [ "$start_pentest" -eq 1 ]; then
	read -p "Enter the target domain/IP: " target
	mkdir -p "${target}_info"
	echo -e "${BRIGHTBLUE}Collecting OSINT on the target...${RESET}"
	mkdir -p ${target}_info/osint
	echo -e "${BRIGHTBLUE}whois...${RESET}"
	$proxy_command whois "$target" > ${target}_info/osint/whois
	echo -e "${BRIGHTBLUE}Executing nmap scan on $target...${RESET}"
	./nmap_scan.sh $target $proxy_command
	echo -e "${BRIGHTBLUE}Finding directories...${RESET}"
	./directories.sh $target $proxy_command
fi
